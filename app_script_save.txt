const SHEET_ID = '...';
const SHEET_NAME = 'Sheet1'; // Change if your sheet tab name is different

function doPost(e) {
  try {
    // get data from front-end
    const payload = JSON.parse(e.postData.contents);
    const originalMessage = payload.message;
    const processedMessage = addKtoSmallNumbers(originalMessage);
    const timestamp = new Date();

    // Append to Google Sheet
    const sheet = SpreadsheetApp.openById(SHEET_ID).getSheetByName(SHEET_NAME);
    sheet.appendRow([timestamp, originalMessage, processedMessage]);

    return ContentService
      .createTextOutput(processedMessage)
      .setMimeType(ContentService.MimeType.TEXT);

  } catch (err) {
    return ContentService
      .createTextOutput("âŒ Error: " + err.toString())
      .setMimeType(ContentService.MimeType.TEXT);
  }
}

function addKtoSmallNumbers(text) {
  return text.replace(/\b(\d{1,3})(?!k)\b/g, (match, num) => {
    return parseInt(num) < 1000 ? num + 'k' : num;
  });
}
